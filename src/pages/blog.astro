---
import Layout from "../layouts/Layout.astro";
import { getPageRes, getBlogListRes } from "../helper/utils";
import type { Page, Post } from "../type/page";
import RenderComponents from "../components/render-components";
import BlogList from "../components/blog-list";
import ArchiveRelative from "../components/archive-relative";
let pageEntry: Page | undefined = undefined;
let blogList: Post[] | undefined = undefined;
try {
  pageEntry = await getPageRes("/blog");
  blogList = await getBlogListRes();

} catch (error) {
  console.error(error);
  Astro.redirect("404");
}

const archivePost:Post[] =[]
const blogs:Post[] = []
 blogList?.forEach(post => {
  post.is_archived? archivePost.push(post): blogs.push(post);
 })

---

<Layout title="Blogs">
  <main>
    <>
    {pageEntry?.page_components && (
      <RenderComponents
        pageComponents={pageEntry.page_components}
        blogPost
        contentTypeUid='page'
        entryUid={pageEntry.uid}
        locale={pageEntry.locale}
      />
    )}
    <div class='blog-container'>
      <div class='blog-column-left'>
        {
        blogs.length &&
        blogs.map((blogList) => (
            <BlogList bloglist={blogList}/>
          ))
        }
      </div>
      <div class='blog-column-right'>
        {pageEntry && pageEntry.page_components[1].widget && (
          <h2>{pageEntry.page_components[1].widget.title_h2}</h2>
        )}
        {archivePost &&(
          <ArchiveRelative blogs={archivePost} />
        )}
      </div>
    </div>
  </>
  </main>
</Layout>
